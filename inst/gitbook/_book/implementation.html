<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>The Fitch Algorithm</title>
  <meta name="description" content="Inapplicable data in a parsimony setting">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="The Fitch Algorithm" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Inapplicable data in a parsimony setting" />
  <meta name="github-repo" content="TGuillerme/Inapp" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="The Fitch Algorithm" />
  
  <meta name="twitter:description" content="Inapplicable data in a parsimony setting" />
  

<meta name="author" content="Thomas Guillerme; Martin R. Smith">


<meta name="date" content="2018-03-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="a-solution.html">
<link rel="next" href="coding-data.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceLine, a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
div.sourceLine, a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource div.sourceLine, .numberSource a.sourceLine
  { position: relative; }
pre.numberSource div.sourceLine::before, .numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em; }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; color: #aaaaaa;  padding-left: 4px; }
@media screen {
a.sourceLine::before { text-decoration: underline; color = initial; }
}
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.bn { color: #40a070; } /* BaseN */
code span.fl { color: #40a070; } /* Float */
code span.ch { color: #4070a0; } /* Char */
code span.st { color: #4070a0; } /* String */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.ot { color: #007020; } /* Other */
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.fu { color: #06287e; } /* Function */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #880000; } /* Constant */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.ss { color: #bb6688; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #19177c; } /* Variable */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.op { color: #666666; } /* Operator */
code span.bu { } /* BuiltIn */
code span.ex { } /* Extension */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.at { color: #7d9029; } /* Attribute */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Inapplicable data in a parsimony setting</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="fitch.html"><a href="fitch.html"><i class="fa fa-check"></i><b>1</b> The Fitch algorithm</a><ul>
<li class="chapter" data-level="1.1" data-path="fitch.html"><a href="fitch.html#downpass"><i class="fa fa-check"></i><b>1.1</b> Downpass</a></li>
<li class="chapter" data-level="1.2" data-path="fitch.html"><a href="fitch.html#uppass"><i class="fa fa-check"></i><b>1.2</b> Uppass</a></li>
<li class="chapter" data-level="1.3" data-path="fitch.html"><a href="fitch.html#optimizing-ambiguous-characters"><i class="fa fa-check"></i><b>1.3</b> Optimizing ambiguous characters</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="problems.html"><a href="problems.html"><i class="fa fa-check"></i><b>2</b> Problems with the Fitch algorithm</a><ul>
<li class="chapter" data-level="2.1" data-path="problems.html"><a href="problems.html#red-tails-blue-tails"><i class="fa fa-check"></i><b>2.1</b> Red tails, blue tails</a></li>
<li class="chapter" data-level="2.2" data-path="problems.html"><a href="problems.html#why-reductive-coding-doesnt-work"><i class="fa fa-check"></i><b>2.2</b> Why Reductive coding doesn’t work</a><ul>
<li class="chapter" data-level="2.2.1" data-path="problems.html"><a href="problems.html#an-exception"><i class="fa fa-check"></i><b>2.2.1</b> An exception</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="problems.html"><a href="problems.html#why-extra-state-coding-doesnt-work"><i class="fa fa-check"></i><b>2.3</b> Why Extra State coding doesn’t work</a></li>
<li class="chapter" data-level="2.4" data-path="problems.html"><a href="problems.html#why-a-single-multi-state-character-doesnt-work"><i class="fa fa-check"></i><b>2.4</b> Why a single multi-state character doesn’t work</a></li>
<li class="chapter" data-level="2.5" data-path="problems.html"><a href="problems.html#sankoff-matrices"><i class="fa fa-check"></i><b>2.5</b> Sankoff matrices</a><ul>
<li class="chapter" data-level="2.5.1" data-path="problems.html"><a href="problems.html#symmetric"><i class="fa fa-check"></i><b>2.5.1</b> Symmetric</a></li>
<li class="chapter" data-level="2.5.2" data-path="problems.html"><a href="problems.html#gain-and-loss-asymmetric"><i class="fa fa-check"></i><b>2.5.2</b> Gain and loss asymmetric</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="problems.html"><a href="problems.html#why-counting-steps-cannot-work"><i class="fa fa-check"></i><b>2.6</b> Why counting steps cannot work</a></li>
<li class="chapter" data-level="2.7" data-path="problems.html"><a href="problems.html#conclusion"><i class="fa fa-check"></i><b>2.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="a-solution.html"><a href="a-solution.html"><i class="fa fa-check"></i><b>3</b> A solution</a><ul>
<li class="chapter" data-level="3.1" data-path="a-solution.html"><a href="a-solution.html#minimising-homoplasy"><i class="fa fa-check"></i><b>3.1</b> Minimising homoplasy</a><ul>
<li class="chapter" data-level="3.1.1" data-path="a-solution.html"><a href="a-solution.html#what-does-it-take-to-denote-separate-regions"><i class="fa fa-check"></i><b>3.1.1</b> What does it take to denote separate regions?</a></li>
<li class="chapter" data-level="3.1.2" data-path="a-solution.html"><a href="a-solution.html#how-this-fixes-the-problem"><i class="fa fa-check"></i><b>3.1.2</b> How this fixes the problem</a></li>
<li class="chapter" data-level="3.1.3" data-path="a-solution.html"><a href="a-solution.html#summary"><i class="fa fa-check"></i><b>3.1.3</b> Summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="implementation.html"><a href="implementation.html"><i class="fa fa-check"></i><b>4</b> Implementation</a><ul>
<li class="chapter" data-level="4.1" data-path="implementation.html"><a href="implementation.html#passes-1-2"><i class="fa fa-check"></i><b>4.1</b> Passes 1 &amp; 2</a></li>
<li class="chapter" data-level="4.2" data-path="implementation.html"><a href="implementation.html#pass-3"><i class="fa fa-check"></i><b>4.2</b> Pass 3</a><ul>
<li class="chapter" data-level="4.2.1" data-path="implementation.html"><a href="implementation.html#tracking-applicable-regions"><i class="fa fa-check"></i><b>4.2.1</b> Tracking applicable regions</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="implementation.html"><a href="implementation.html#pass-4"><i class="fa fa-check"></i><b>4.3</b> Pass 4</a></li>
<li class="chapter" data-level="4.4" data-path="implementation.html"><a href="implementation.html#software-implementation"><i class="fa fa-check"></i><b>4.4</b> Software implementation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="coding-data.html"><a href="coding-data.html"><i class="fa fa-check"></i><b>5</b> Coding data</a><ul>
<li class="chapter" data-level="5.1" data-path="coding-data.html"><a href="coding-data.html#multiple-dependencies"><i class="fa fa-check"></i><b>5.1</b> Multiple dependencies</a></li>
<li class="chapter" data-level="5.2" data-path="coding-data.html"><a href="coding-data.html#invariant-characters-can-inform-parsimony"><i class="fa fa-check"></i><b>5.2</b> Invariant characters can inform parsimony</a></li>
<li class="chapter" data-level="5.3" data-path="coding-data.html"><a href="coding-data.html#variable-but-parsimony-uninformative-characters-can-inform-parsimony"><i class="fa fa-check"></i><b>5.3</b> Variable but ‘parsimony uninformative’ characters can inform parsimony</a></li>
<li class="chapter" data-level="5.4" data-path="coding-data.html"><a href="coding-data.html#this-may-not-be-desirable-in-neomorphic-characters"><i class="fa fa-check"></i><b>5.4</b> This may not be desirable in neomorphic characters</a><ul>
<li class="chapter" data-level="5.4.1" data-path="coding-data.html"><a href="coding-data.html#three-scenarios"><i class="fa fa-check"></i><b>5.4.1</b> Three scenarios</a></li>
<li class="chapter" data-level="5.4.2" data-path="coding-data.html"><a href="coding-data.html#does-absence-contain-phylogenetic-information"><i class="fa fa-check"></i><b>5.4.2</b> Does absence contain phylogenetic information?</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="coding-data.html"><a href="coding-data.html#coding-ontologically-dependent-neomorphic-characters"><i class="fa fa-check"></i><b>5.5</b> Coding ontologically dependent neomorphic characters</a><ul>
<li class="chapter" data-level="5.5.1" data-path="coding-data.html"><a href="coding-data.html#neomorphic-and-transformational-characters"><i class="fa fa-check"></i><b>5.5.1</b> Neomorphic and transformational characters</a></li>
<li class="chapter" data-level="5.5.2" data-path="coding-data.html"><a href="coding-data.html#three-trees"><i class="fa fa-check"></i><b>5.5.2</b> Three trees</a></li>
<li class="chapter" data-level="5.5.3" data-path="coding-data.html"><a href="coding-data.html#recommendation"><i class="fa fa-check"></i><b>5.5.3</b> Recommendation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ambiguity.html"><a href="ambiguity.html"><i class="fa fa-check"></i><b>6</b> Ambiguity</a><ul>
<li class="chapter" data-level="6.1" data-path="ambiguity.html"><a href="ambiguity.html#ambiguity-when-parent-character-ambiguous"><i class="fa fa-check"></i><b>6.1</b> Ambiguity when parent character ambiguous</a></li>
<li class="chapter" data-level="6.2" data-path="ambiguity.html"><a href="ambiguity.html#ambiguity-when-parent-character-known"><i class="fa fa-check"></i><b>6.2</b> Ambiguity when parent character known</a><ul>
<li class="chapter" data-level="6.2.1" data-path="ambiguity.html"><a href="ambiguity.html#subordinate-character-has-finite-states"><i class="fa fa-check"></i><b>6.2.1</b> Subordinate character has finite states</a></li>
<li class="chapter" data-level="6.2.2" data-path="ambiguity.html"><a href="ambiguity.html#subordinate-character-may-have-unobserved-states"><i class="fa fa-check"></i><b>6.2.2</b> Subordinate character may have unobserved states</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ambiguity.html"><a href="ambiguity.html#recommendation-1"><i class="fa fa-check"></i><b>6.3</b> Recommendation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>7</b> Examples</a><ul>
<li class="chapter" data-level="7.1" data-path="examples.html"><a href="examples.html#some-caterpillars"><i class="fa fa-check"></i><b>7.1</b> Some caterpillars</a></li>
<li class="chapter" data-level="7.2" data-path="examples.html"><a href="examples.html#three-equally-suboptimal-alternatives"><i class="fa fa-check"></i><b>7.2</b> Three equally suboptimal alternatives</a></li>
<li class="chapter" data-level="7.3" data-path="examples.html"><a href="examples.html#a-better-caterpillar-tree"><i class="fa fa-check"></i><b>7.3</b> A better caterpillar tree</a></li>
<li class="chapter" data-level="7.4" data-path="examples.html"><a href="examples.html#de-laets-caterpillars"><i class="fa fa-check"></i><b>7.4</b> De Laet’s caterpillars</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>8</b> References</a></li>
<li class="chapter" data-level="9" data-path="inapplicable-data-in-a-parsimony-setting.html"><a href="inapplicable-data-in-a-parsimony-setting.html"><i class="fa fa-check"></i><b>9</b> Inapplicable data in a parsimony setting</a></li>
<li class="divider"></li>
<li><a href="https://github.com/TGuillerme/Inapp/" target="blank">Project GitHub page</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Fitch Algorithm</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="implementation" class="section level1">
<h1><span class="header-section-number">4</span> Implementation</h1>
<p>Consider a tree with 12 taxa and the following multi-state characters with inapplicable data <code>23--1??--032</code>; say the character is “colour of the tail” ranging from 0 to 3 (four colours).
Four taxa in our example have no tail (hence the inapplicable data <code>-</code>) and for two taxa, the data is missing (<code>?</code>- we don’t known the colour of the tail or even whether the taxa have a tail or not).</p>
<p><img src="Inapplicable_data_files/figure-html/unnamed-chunk-32-1.png" width="681.6" /></p>
<p>We can use the <code>Inapp</code> package to apply our four passes inapplicable algorithm for this character on this tree.</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">## Loading the Inapp package</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">library</span>(Inapp)</div>
<div class="sourceLine" id="3" href="#3" data-line-number="3"></div>
<div class="sourceLine" id="4" href="#4" data-line-number="4">## The tree</div>
<div class="sourceLine" id="5" href="#5" data-line-number="5">tree &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="dt">text =</span> <span class="st">&quot;((((((1,2),3),4),5),6),(7,(8,(9,(10,(11,12))))));&quot;</span>)</div>
<div class="sourceLine" id="6" href="#6" data-line-number="6"></div>
<div class="sourceLine" id="7" href="#7" data-line-number="7">## The character</div>
<div class="sourceLine" id="8" href="#8" data-line-number="8">character &lt;-<span class="st"> &quot;23--1??--032&quot;</span></div>
<div class="sourceLine" id="9" href="#9" data-line-number="9"></div>
<div class="sourceLine" id="10" href="#10" data-line-number="10">## Applying the NA algorithm</div>
<div class="sourceLine" id="11" href="#11" data-line-number="11">matrix &lt;-<span class="st"> </span><span class="kw">apply.reconstruction</span>(tree, character, <span class="dt">method =</span> <span class="st">&quot;NA&quot;</span>, <span class="dt">passes =</span> <span class="dv">4</span>)</div></code></pre>
<p>Here is what is happening:</p>
<div id="passes-1-2" class="section level2">
<h2><span class="header-section-number">4.1</span> Passes 1 &amp; 2</h2>
<p>The first two passes are a standard Fitch algorithm applied the the parent character of the studied character (see [Fitch.Rmd]) with a special rule for the inapplicable state (<code>-</code>).</p>
<p>For the first pass (first downpass):</p>
<ul>
<li>If state in common between the two descendants is the inapplicable state, but that both have also applicable states, set the node’s state to be the union between the descendants states (rather than their state in common).</li>
<li>If there is no state in common between the descendants and both descendants have applicable states, remove the inapplicable state from their union (rather than simply setting the nodal state to their union).</li>
</ul>
<p>For the second pass (first uppass):</p>
<ul>
<li>If the focal node has both applicable and inapplicable states, set it to be the inapplicable state only if its ancestor has also only the inapplicable state, else remove the inapplicable state.</li>
<li>If the focal node has only an inapplicable state and it’s ancestor has not only the inapplicable state, set it to be the union between it’s descendants states if their are both applicable, else, leave it as the inapplicable state.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">## Plotting the NA two first passes</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">plot</span>(matrix, <span class="dt">passes =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">counts =</span> <span class="dv">0</span>, <span class="dt">main =</span> <span class="st">&quot;Inapplicable reconstruction&quot;</span>)</div></code></pre>
<p><img src="Inapplicable_data_files/figure-html/unnamed-chunk-34-1.png" width="681.6" /></p>
<p>The parent character can be considered as a binary character “presence (<code>1</code>) or absence (<code>0</code>) of a tail” that would be <code>11001??00111</code>.
The character would be reconstructed as:</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">## The parent character</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2">parent_character &lt;-<span class="st"> &quot;11001??00111&quot;</span></div>
<div class="sourceLine" id="3" href="#3" data-line-number="3"></div>
<div class="sourceLine" id="4" href="#4" data-line-number="4">## Applying the Fitch algorithm</div>
<div class="sourceLine" id="5" href="#5" data-line-number="5">matrix_parent &lt;-<span class="st"> </span><span class="kw">apply.reconstruction</span>(tree, parent_character, <span class="dt">method =</span> <span class="st">&quot;Fitch&quot;</span>, <span class="dt">passes =</span> <span class="dv">2</span>)</div>
<div class="sourceLine" id="6" href="#6" data-line-number="6"><span class="kw">plot</span>(matrix_parent, <span class="dt">passes =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">counts =</span> <span class="dv">0</span>, <span class="dt">main =</span> <span class="st">&quot;Fitch reconstruction of the parent character&quot;</span>)</div></code></pre>
<p><img src="Inapplicable_data_files/figure-html/unnamed-chunk-35-1.png" width="681.6" /></p>
<p>As you can see, both reconstructions are identical: nodes with no tail are denoted as <code>0</code> in the case of the “parent character” and as <code>-</code> for our current character.
Note however that contrary to the Fitch algorithm, there is no tree score counting in our algorithm for the two first passes.
Indeed, in the case of the Fitch reconstruction of the “parent character”, the gain or losses of a tail are counted but not the changes in states for the subtending character (the tree score is 3 in Fitch, 5 in our case).</p>
</div>
<div id="pass-3" class="section level2">
<h2><span class="header-section-number">4.2</span> Pass 3</h2>
<p>The third pass further resolves ambiguities at nodal states.
If the node is applicable, the standard Fitch downpass comparisons between the descendants are applied (see [Fitch.Rmd]) but with the rules relative to the inapplicable state described for the first downpass above.</p>
<p>During this pass, we can also count the tree score.
This score is composed of both:</p>
<ul>
<li>the change in states (e.g. the change in the colour of the tail)</li>
<li>the change between applicable and inapplicable regions (e.g. the change in the parent character: a gain or a loss of the tail)</li>
</ul>
<p>The changes of states are calculated the same way as Fitch <strong>for the applicable states only</strong>:</p>
<ol style="list-style-type: decimal">
<li>If there is no state in common between both node’s descendants and that the node and its descendant have a least one applicable state, increment the tree score.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">## Plotting the NA two first passes</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">plot</span>(matrix, <span class="dt">passes =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">counts =</span> <span class="dv">2</span>, <span class="dt">main =</span> <span class="st">&quot;State changes&quot;</span>, <span class="dt">show.labels =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div></code></pre>
<p><img src="Inapplicable_data_files/figure-html/unnamed-chunk-36-1.png" width="681.6" /></p>
<p>For example, for node <code>n23</code>, there is no state in common between the tip <code>12</code> (<code>2</code>) and <code>11</code> (<code>3</code>), the tree score is incremented at this node (case <code>1</code> above).
Note, however, that for node <code>n21</code>, there is no state in common between node <code>n22</code> (<code>023</code>) and tip <code>9</code> (<code>-</code>) but the score is not incremented since it does not concern applicable states only.
In other words, there is no change in state at the node <code>n21</code> from the tail having a colour 0, 2 or 3 to the tail not being present (<code>-</code>) but rather a change in the parent character between presence and absence of the tail (present is <code>023</code> and absent is <code>-</code>).</p>
<div id="tracking-applicable-regions" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Tracking applicable regions</h3>
<p>To know whether any node leads to a region of applicable states we can use a “tracker” for each node that tells us at any moment whether descendants of a node contain applicable data or not.
Doing so, we can know, when a node is inapplicable and its descendant lead to applicable regions that extra applicable regions are implied by the tree.
In other words and following our “colour of the tail” character, extra applicable regions imply independent appearances of the tail somewhere in the node’s descendants.</p>
<p>The tracker is initialised during the <em>second pass</em> (first uppass) and is updated during the <em>third pass</em> (second downpass).
The tracker works as follows for each node’s left and right descendants:</p>
<ul>
<li>If the descendant state was resolved as applicable, the node leads to an applicable region, else, it leads to an inapplicable one.</li>
</ul>
<p>The trackers are initialised for each node during the first uppass and then propagated back down the tree during the second downpass.</p>
<p>Using these trackers, we can then increments the tree score for all changes that imply a new applicable region.
The switch to or from an inapplicable and applicable region are counted as follow:</p>
<ol start="2" style="list-style-type: decimal">
<li>If the node is inapplicable and both descendants lead to regions of applicable states, increment the region count.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">## Plotting the NA two first passes</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">plot</span>(matrix, <span class="dt">passes =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">counts =</span> <span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;Applicable regions&quot;</span>, <span class="dt">show.labels =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div></code></pre>
<p><img src="Inapplicable_data_files/figure-html/unnamed-chunk-37-1.png" width="681.6" /></p>
<p>For example, node <code>n15</code> is solved as inapplicable but both his descendants lead to two independent applicable regions (tip <code>5</code> with the state <code>1</code> and node <code>n18</code> with the states <code>1</code> and <code>2</code>).
This implies an independent change in the parent character (in our example, tail is absent at node <code>n15</code> but evolves independently at tip <code>5</code> and node <code>n18</code>).
Conversely, node <code>n21</code> is solved as inapplicable but not both his descendants lead to independent applicable regions.
This node does thus not imply an independent change in the parent character.</p>
<blockquote>
<p>Note that the number of applicable regions for a character is always at least 1 (unless every taxa has the inapplicable state) and therefore, we only count the <em>additional</em> regions.</p>
</blockquote>
<p>Combining both scores - the number of changes in character states and the number of additional applicable regions - we get indeed a total tree score of 5 for this tree and character</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">## Plotting the NA two first passes</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">plot</span>(matrix, <span class="dt">passes =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">counts =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">show.labels =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div></code></pre>
<p><img src="Inapplicable_data_files/figure-html/unnamed-chunk-38-1.png" width="681.6" /></p>
<p>Using these tree passes is enough to get the tree score (while taking into account inapplicable data!) but does not solve all ancestral reconstructions.
A fourth pass (second uppass) might be necessary to finalise the node states reconstructions.</p>
</div>
</div>
<div id="pass-4" class="section level2">
<h2><span class="header-section-number">4.3</span> Pass 4</h2>
<p>In the example above, the node <code>n23</code> is still not correctly solved after the third pass.
In fact, considering its ancestor’s states (<code>023</code>) and its descendants’ states (<code>2</code> and <code>3</code>), it should be resolved as <code>023</code> under a delayed transition model (DELTRAN).
In order to do so, we can apply a extra pass similar to the second pass (first uppass), as described above.</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">## Plotting the NA two first passes</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">plot</span>(matrix, <span class="dt">passes =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="dt">counts =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">show.labels =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div></code></pre>
<p><img src="Inapplicable_data_files/figure-html/unnamed-chunk-39-1.png" width="681.6" /></p>
</div>
<div id="software-implementation" class="section level2">
<h2><span class="header-section-number">4.4</span> Software implementation</h2>
<p>This algorithm has been implemented in two <code>R</code> packages. <a href="https://github.com/TGuillerme/Inapp">Inapp</a> provides an interactive
visualization of how the score of a user-specified tree is calculated for any
character under different approaches to inapplicable data.<br />
This package was used to generate many of the figures in this document.</p>
<p><a href="https://github.com/ms609/TreeSearch">TreeSearch</a> allows for parsimony tree
searches with the inapplicable algorithm <span class="citation">(Brazeau, Guillerme, &amp; Smith, <a href="#ref-ThisStudy">2017</a>)</span>.<br />
It includes heuristic search options that make it possible to search reasonable-sized matrices, and includes an option for equal or implied weighting.</p>
<p>TreeSearch is a front-end to the <a href="https://github.com/mbrazeau/morphylib">morphylib</a>
<code>C</code> library, which will eventually implemented in the standalone <a href="http://www.morphyproject.org/">Morphy</a> program for rapid phylogenetic searches.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-ThisStudy">
<p>Brazeau, M. D., Guillerme, T., &amp; Smith, M. R. (2017). Morphological phylogenetic analysis with inapplicable data. <em>bioR<span class="math inline">\(\chi\)</span>iv</em>. doi:<a href="https://doi.org/10.1101/209775">10.1101/209775</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="a-solution.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="coding-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/TGuillerme/Inapp/inst/gitbook/edit/master/05_OurAlgorithm.Rmd",
"text": "Edit"
},
"download": ["Inapplicable_data.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
